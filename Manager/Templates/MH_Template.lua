local items = {
  [ 30874] = {boss =  619, slot = 13, xtype =  6, level = 141, name = "The Unbreakable Will", bis = {"TWa"}, opt = {}}, -- Anetheron
  [ 30878] = {boss =  619, slot =  3, xtype =  4, level = 141, name = "Glimmering Steel Mantle", bis = {}, opt = {"HPa"}}, -- Anetheron
  [ 30879] = {boss =  619, slot =  8, xtype =  2, level = 141, name = "Don Alejandro's Money Belt", bis = {"BMHu","MSHu","SVHu"}, opt = {"MDr","MSh","Ro","TDr"}}, -- Anetheron
  [ 30880] = {boss =  619, slot = 10, xtype =  3, level = 141, name = "Quickstrider Moccasins", bis = {}, opt = {"MSh"}}, -- Anetheron
  [ 30881] = {boss =  619, slot = 13, xtype =  6, level = 141, name = "Blade of Infamy", bis = {"BMHu","MSHu","SVHu"}, opt = {"Arms","Fury","Ro"}}, -- Anetheron
  [ 30882] = {boss =  619, slot = 15, xtype = 17, level = 141, name = "Bastion of Light", bis = {"HPa","HSh"}, opt = {}}, -- Anetheron
  [ 30883] = {boss =  619, slot = 16, xtype = 10, level = 141, name = "Pillar of Ferocity", bis = {"TDr"}, opt = {"MDr"}}, -- Anetheron
  [ 30884] = {boss =  619, slot =  3, xtype =  1, level = 141, name = "Hatefury Mantle", bis = {}, opt = {"Affli","Arcane","Demo","Destro","RSh","Fire","Frost","RDr","RPr"}}, -- Anetheron
  [ 30885] = {boss =  619, slot = 10, xtype =  1, level = 141, name = "Archbishop's Slippers", bis = {}, opt = {"HDr"}}, -- Anetheron
  [ 30886] = {boss =  619, slot = 10, xtype =  2, level = 141, name = "Enchanted Leather Sandals", bis = {}, opt = {"HDr"}}, -- Anetheron
  [ 30887] = {boss =  619, slot =  5, xtype =  3, level = 141, name = "Golden Links of Restoration", bis = {}, opt = {"HSh"}}, -- Anetheron
  [ 30888] = {boss =  619, slot =  8, xtype =  1, level = 141, name = "Anetheron's Noose", bis = {"Affli","Arcane","Demo","Destro","RDr"}, opt = {"Fire","Frost","RPr"}}, -- Anetheron

  [ 30902] = {boss =  622, slot = 16, xtype =  6, level = 151, name = "Cataclysm's Edge", bis = {"Arms"}, opt = {"MPa"}}, -- Archimonde
  [ 30903] = {boss =  622, slot =  9, xtype =  4, level = 151, name = "Legguards of Endless Rage", bis = {}, opt = {"Arms","Fury","TWa"}}, -- Archimonde
  [ 30904] = {boss =  622, slot =  5, xtype =  4, level = 151, name = "Savior's Grasp", bis = {}, opt = {"HPa"}}, -- Archimonde
  [ 30905] = {boss =  622, slot =  5, xtype =  2, level = 151, name = "Midnight Chestguard", bis = {"MPa","MSh"}, opt = {"Arms","Fury","MDr","Ro","TDr"}}, -- Archimonde
  [ 30906] = {boss =  622, slot = 17, xtype = 12, level = 151, name = "Bristleblitz Striker", bis = {"BMHu","MSHu","SVHu"}, opt = {}}, -- Archimonde
  [ 30907] = {boss =  622, slot =  5, xtype =  3, level = 151, name = "Mail of Fevered Pursuit", bis = {}, opt = {}}, -- Archimonde
  [ 30908] = {boss =  622, slot = 16, xtype = 10, level = 151, name = "Apostle of Argus", bis = {"HDr"}, opt = {"HPr"}}, -- Archimonde
  [ 30909] = {boss =  622, slot = 15, xtype = 17, level = 151, name = "Antonidas's Aegis of Rapt Concentration", bis = {"RSh","TPa"}, opt = {}}, -- Archimonde
  [ 30910] = {boss =  622, slot = 14, xtype =  6, level = 151, name = "Tempest of Chaos", bis = {"Affli","Arcane","Demo","Destro","Fire","Frost","TPa"}, opt = {}}, -- Archimonde
  [ 30911] = {boss =  622, slot = 15, xtype =  0, level = 151, name = "Scepter of Purification", bis = {"HDr","HPa","HPr"}, opt = {}}, -- Archimonde
  [ 30912] = {boss =  622, slot =  9, xtype =  1, level = 151, name = "Leggings of Eternity", bis = {"HDr","HPr"}, opt = {"HPa","HSh"}}, -- Archimonde
  [ 30913] = {boss =  622, slot =  5, xtype =  1, level = 151, name = "Robes of Rhonin", bis = {}, opt = {"Affli","Arcane","Demo","Destro","Fire","Frost","RDr","RPr"}}, -- Archimonde
  [ 31095] = {boss =  622, slot =  1, xtype = 18, level =  70, name = "Helm of the Forgotten Protector", bis = {"RSh","HSh","SVHu"}, opt = {"Arms","BMHu","Fury","MSh","MSHu","TWa"}}, -- Archimonde
  [ 31096] = {boss =  622, slot =  1, xtype = 18, level =  70, name = "Helm of the Forgotten Vanquisher", bis = {"HDr","RDr","TDr"}, opt = {"Arcane","Fire","Frost","Ro"}}, -- Archimonde
  [ 31097] = {boss =  622, slot =  1, xtype = 18, level =  70, name = "Helm of the Forgotten Conqueror", bis = {"Affli","Demo","Destro","HPa","HPr","RPr","TPa"}, opt = {"MPa"}}, -- Archimonde

  [ 30896] = {boss =  621, slot =  5, xtype =  4, level = 141, name = "Glory of the Defender", bis = {}, opt = {"TPa","TWa"}}, -- Azgalor
  [ 30897] = {boss =  621, slot =  8, xtype =  4, level = 141, name = "Girdle of Hope", bis = {"HPa"}, opt = {}}, -- Azgalor
  [ 30898] = {boss =  621, slot =  9, xtype =  2, level = 141, name = "Shady Dealer's Pantaloons", bis = {}, opt = {"Arms","BMHu","Fury","MDr","MSh","MSHu","Ro","SVHu","TDr"}}, -- Azgalor
  [ 30899] = {boss =  621, slot =  5, xtype =  2, level = 141, name = "Don Rodrigo's Poncho", bis = {}, opt = {}}, -- Azgalor
  [ 30900] = {boss =  621, slot =  9, xtype =  3, level = 141, name = "Bow-stitched Leggings", bis = {"MPa","MSh","SVHu"}, opt = {"BMHu","MSHu"}}, -- Azgalor
  [ 30901] = {boss =  621, slot = 13, xtype =  5, level = 141, name = "Boundless Agony", bis = {"BMHu","MSHu"}, opt = {}}, -- Azgalor
  [ 31092] = {boss =  621, slot =  7, xtype = 18, level =  70, name = "Gloves of the Forgotten Conqueror", bis = {"Affli","Demo","Destro","HPr","RPr","TPa"}, opt = {"HPa"}}, -- Azgalor
  [ 31093] = {boss =  621, slot =  7, xtype = 18, level =  70, name = "Gloves of the Forgotten Vanquisher", bis = {"Fire","Frost","MDr","RDr","Ro","TDr"}, opt = {"Arcane","HDr"}}, -- Azgalor
  [ 31094] = {boss =  621, slot =  7, xtype = 18, level =  70, name = "Gloves of the Forgotten Protector", bis = {"BMHu","RSh","MSHu","SVHu"}, opt = {"Arms","Fury","HSh"}}, -- Azgalor

  [ 30889] = {boss =  620, slot = 15, xtype = 17, level = 141, name = "Kaz'rogal's Hardened Heart", bis = {}, opt = {"TPa","TWa"}}, -- Kaz'rogal
  [ 30891] = {boss =  620, slot = 10, xtype =  2, level = 141, name = "Black Featherlight Boots", bis = {}, opt = {}}, -- Kaz'rogal
  [ 30892] = {boss =  620, slot =  3, xtype =  3, level = 141, name = "Beast-tamer's Shoulders", bis = {}, opt = {"BMHu","MSHu"}}, -- Kaz'rogal
  [ 30893] = {boss =  620, slot =  9, xtype =  3, level = 141, name = "Sun-touched Chain Leggings", bis = {}, opt = {"HPa","HSh"}}, -- Kaz'rogal
  [ 30894] = {boss =  620, slot = 10, xtype =  1, level = 141, name = "Blue Suede Shoes", bis = {}, opt = {"Affli","Arcane","Demo","Destro","Fire","Frost","RDr","RPr","TPa"}}, -- Kaz'rogal
  [ 30895] = {boss =  620, slot =  8, xtype =  1, level = 141, name = "Angelista's Sash", bis = {"HDr","HPr","HSh"}, opt = {}}, -- Kaz'rogal
  [ 30914] = {boss =  620, slot =  8, xtype =  2, level = 141, name = "Belt of the Crescent Moon", bis = {}, opt = {"RDr"}}, -- Kaz'rogal
  [ 30915] = {boss =  620, slot =  8, xtype =  4, level = 141, name = "Belt of Seething Fury", bis = {}, opt = {}}, -- Kaz'rogal
  [ 30916] = {boss =  620, slot =  9, xtype =  1, level = 141, name = "Leggings of Channeled Elements", bis = {"Affli","Demo","Destro","RSh","RDr","RPr"}, opt = {"Arcane","Fire","Frost"}}, -- Kaz'rogal
  [ 30917] = {boss =  620, slot =  3, xtype =  2, level = 141, name = "Razorfury Mantle", bis = {}, opt = {"Ro","TDr"}}, -- Kaz'rogal
  [ 30918] = {boss =  620, slot = 14, xtype =  8, level = 141, name = "Hammer of Atonement", bis = {"HPa"}, opt = {"HDr","HPr","HSh"}}, -- Kaz'rogal
  [ 30919] = {boss =  620, slot =  8, xtype =  3, level = 141, name = "Valestalker Girdle", bis = {}, opt = {"MSh"}}, -- Kaz'rogal

  [ 30861] = {boss =  618, slot =  6, xtype =  4, level = 141, name = "Furious Shackles", bis = {}, opt = {"Fury","TWa"}}, -- Rage Winterchill
  [ 30862] = {boss =  618, slot =  6, xtype =  4, level = 141, name = "Blessed Adamantite Bracers", bis = {"HPa"}, opt = {}}, -- Rage Winterchill
  [ 30863] = {boss =  618, slot =  6, xtype =  2, level = 141, name = "Deadly Cuffs", bis = {"Arms","Fury","MSh"}, opt = {"MDr","Ro","TDr"}}, -- Rage Winterchill
  [ 30864] = {boss =  618, slot =  6, xtype =  3, level = 141, name = "Bracers of the Pathfinder", bis = {}, opt = {}}, -- Rage Winterchill
  [ 30865] = {boss =  618, slot = 13, xtype =  5, level = 141, name = "Tracker's Blade", bis = {}, opt = {"BMHu","MSHu","Ro"}}, -- Rage Winterchill
  [ 30866] = {boss =  618, slot =  3, xtype =  4, level = 141, name = "Blood-stained Pauldrons", bis = {}, opt = {}}, -- Rage Winterchill
  [ 30868] = {boss =  618, slot =  6, xtype =  2, level = 141, name = "Rejuvenating Bracers", bis = {"HDr"}, opt = {}}, -- Rage Winterchill
  [ 30869] = {boss =  618, slot =  6, xtype =  3, level = 141, name = "Howling Wind Bracers", bis = {}, opt = {"HPa","HSh"}}, -- Rage Winterchill
  [ 30870] = {boss =  618, slot =  6, xtype =  1, level = 141, name = "Cuffs of Devastation", bis = {"Arcane"}, opt = {"Affli","Demo","Destro","RSh","Fire","Frost","RDr","RPr"}}, -- Rage Winterchill
  [ 30871] = {boss =  618, slot =  6, xtype =  1, level = 141, name = "Bracers of Martyrdom", bis = {"HDr","HPr"}, opt = {}}, -- Rage Winterchill
  [ 30872] = {boss =  618, slot = 15, xtype =  0, level = 141, name = "Chronicle of Dark Secrets", bis = {"Affli","Arcane","Demo","Destro","RSh","Fire","Frost","RDr"}, opt = {"RPr"}}, -- Rage Winterchill
  [ 30873] = {boss =  618, slot = 10, xtype =  3, level = 141, name = "Stillwater Boots", bis = {"HSh"}, opt = {}}, -- Rage Winterchill

  [ 32285] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Flashing Crimson Spinel", bis = {}, opt = {}}, -- All Bosses
  [ 32289] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Stormy Empyrean Sapphire", bis = {}, opt = {}}, -- All Bosses
  [ 32295] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Mystic Lionseye", bis = {}, opt = {}}, -- All Bosses
  [ 32296] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Great Lionseye", bis = {}, opt = {}}, -- All Bosses
  [ 32297] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Sovereign Shadowsong Amethyst", bis = {}, opt = {}}, -- All Bosses
  [ 32298] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Shifting Shadowsong Amethyst", bis = {}, opt = {}}, -- All Bosses
  [ 32303] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Inscribed Pyrestone", bis = {}, opt = {}}, -- All Bosses
  [ 32307] = {boss =    3, slot =  0, xtype = 19, level =  75, name = "Design: Veiled Pyrestone", bis = {}, opt = {}}, -- All Bosses

  [ 32945] = {boss =    1, slot = 15, xtype = 11, level = 141, name = "Fist of Molten Fury", bis = {}, opt = {}}, -- Trash
  [ 32946] = {boss =    1, slot = 14, xtype = 11, level = 141, name = "Claw of Molten Fury", bis = {}, opt = {"MSh"}}, -- Trash
  [ 34009] = {boss =    1, slot = 14, xtype =  8, level = 141, name = "Hammer of Judgement", bis = {"RDr"}, opt = {"RSh","RPr","TPa"}}, -- Trash
  [ 34010] = {boss =    1, slot =  4, xtype =  0, level = 141, name = "Pepe's Shroud of Pacification", bis = {"TPa","TWa"}, opt = {"TDr"}}, -- Trash
}

------------------------------------------------------------

local classes = {
  ["Dr"] = {"HDr", "MDr", "TDr", "RDr"},
  ["Hu"] = {"BMHu", "MSHu", "SVHu"},
  ["Ma"] = {"Arcane", "Fire", "Frost"},
  ["Pa"] = {"HPa", "MPa", "TPa"},
  ["Pr"] = {"HPr", "RPr"},
  ["Ro"] = {"Ro"},
  ["Sh"] = {"HSh", "MSh", "RSh"},
  ["WL"] = {"Affli", "Demo", "Destro"},
  ["Wa"] = {"TWa", "Arms", "Fury"},
}

------------------------------------------------------------

local function Pos(tbl, str)
  for i,v in ipairs(tbl) do
    if v == str then
      return i
    end
  end
  return 0
end

------------------------------------------------------------

local function OptimizeSpecs(tbl)

  -- go through all classes
  for k,v in pairs(classes) do
    local b = true

    -- try to find a missing spec
    for _,s in ipairs(v) do
      if Pos(tbl, s) == 0 then
        b = false
      end
    end

    -- if no missing specs, replace them with class!
    if b then
      for _,s in ipairs(v) do
        local i = Pos(tbl, s)
        table.remove(tbl, i)
      end
      table.insert(tbl, k)
    end
  end
end

------------------------------------------------------------

local base = {
  [ 1] = 250, -- Head
  [ 2] = 200, -- Neck
  [ 3] = 250, -- Shoulder
  [ 4] = 150, -- Back
  [ 5] = 300, -- Chest
  [ 6] = 150, -- Wrist
  [ 7] = 200, -- Hands
  [ 8] = 150, -- Waist
  [ 9] = 300, -- Legs
  [10] = 200, -- Feet
  [11] = 200, -- Finger
  [12] = 300, -- Trinket
  [13] = 450, -- One-Hand
  [14] = 450, -- Main Hand
  [15] = 450, -- Off Hand
  [16] = 600, -- Two-Hand
  [17] = 150, -- Ranged
}

------------------------------------------------------------

local function GetCost(item)

  -- set default values
  local base = base[item.slot] or 0
  local fact1 = 1
  local fact2 = 1
  local fact3 = 1

  if #item.bis == 0 then
    if #item.opt == 0 then
      fact1 = 0.5 -- 50% discount if neither BIS nor OPT
    else
      fact1 = 0.9 -- 10% discount if only OPT
    end
  end

  -- is item level higher than normal?
  if item.level == 151 then
    fact2 = 1.1 -- increase cost by 10%
  end

  -- is item a recipe?
  if item.xtype == 19 then
    if item.slot == 3 then -- shoulders are BoP
      fact3 = 0.5 -- discount 50% due to material cost
    end
    if item.slot == 6 then -- wrists are BoE
      fact3 = 0 -- no cost
    end
  end

  -- calculate cost
  local cost = base * fact1 * fact2 * fact3

  -- round down to the nearest multiple of 5
  return math.floor(cost / 5) * 5
end

------------------------------------------------------------

function GetTemplateTable()
  for id,item in pairs(items) do
    OptimizeSpecs(item.bis)
    OptimizeSpecs(item.opt)
    item.cost = GetCost(item)
  end
  return items
end
